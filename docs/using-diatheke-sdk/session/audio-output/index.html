<!DOCTYPE html>
<html>
  <head>
    <title>Diatheke SDK -- Cobalt</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Audio Output :: Diatheke SDK -- Cobalt</title>
<link rel="shortcut icon" href="/sdk-diatheke/images/favicon.ico" type="image/x-icon" />
<link href="/sdk-diatheke/css/nucleus.css" rel="stylesheet">
<link href="/sdk-diatheke/css/font-awesome.min.css" rel="stylesheet">
<link href="/sdk-diatheke/css/hybrid.css" rel="stylesheet">
<link href="/sdk-diatheke/css/featherlight.min.css" rel="stylesheet">
<link href="/sdk-diatheke/css/auto-complete.css" rel="stylesheet">
<link href="/sdk-diatheke/theme-original/style.css" rel="stylesheet">

  <link href="/sdk-diatheke/theme-original/variant-blue.css" rel="stylesheet">

<link rel="stylesheet" href="/sdk-diatheke/css/bootstrap.min.css">
<script src="/sdk-diatheke/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link href="/sdk-diatheke/css/tabs.css" rel="stylesheet" type="text/css">
<script src="/sdk-diatheke/js/tabs.js"></script>


    
  </head>
  <body data-url="/sdk-diatheke/using-diatheke-sdk/session/audio-output/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p><img src="/sdk-diatheke/images/logo-white.png" alt="Cobalt&rsquo;s SDK Documentation"></p>
<p>Diatheke SDK &ndash; Cobalt</p>

  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/sdk-diatheke/js/lunr.min.js"></script>
		<script type="text/javascript" src="/sdk-diatheke/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/cobaltspeech.github.io\/sdk-diatheke";
        
		</script>
		<script type="text/javascript" src="/sdk-diatheke/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/sdk-diatheke/" class="dd-item">
            <a href="/sdk-diatheke/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/sdk-diatheke/getting-started/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/getting-started/">Getting Started</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/sdk-diatheke/using-diatheke-sdk/">Using Diatheke SDK</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/include/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/include/">
            Including the SDK
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/errors/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/errors/">
            Error Handling
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/connecting/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/connecting/">
            Connecting to the Server
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/sdk-diatheke/using-diatheke-sdk/session/">Sessions</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/create-session/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/create-session/">
            Creating a Session
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/event-stream/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/event-stream/">
            Event Stream
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/push-text/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/push-text/">
            Push Text
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/audio-input/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/audio-input/">
            Audio Input
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/audio-output/" class="dd-item active">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/audio-output/">
            Audio Output
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/streaming-asr/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/streaming-asr/">
            Streaming ASR
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/streaming-tts/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/streaming-tts/">
            Streaming TTS
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/sdk-diatheke/protobuf/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/protobuf/">Diatheke API Reference</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/sdk-diatheke/glossary/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/glossary/">Glossary</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/cobaltspeech/sdk-diatheke" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://www.cobaltspeech.com/contact" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Contact us</label></a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> Clear History</a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        










 <a href='/sdk-diatheke/'>Diatheke SDK Documentation</a> > <a href='/sdk-diatheke/using-diatheke-sdk/'>Using Diatheke SDK</a> > <a href='/sdk-diatheke/using-diatheke-sdk/session/'>Sessions</a> > Audio Output

 

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#creating-the-audio-reply-stream">Creating the Audio Reply Stream</a></li>
  </ul>

  <ul>
    <li><a href="#receiving-audio">Receiving Audio</a></li>
  </ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Audio Output</h1>
  



    
    
    
    <p>The audio output stream is the audio version of the
<a href="../event-stream#reply-event">Reply event</a>. When Diatheke wants to reply
to user input, this stream will receive notifications with the text of
the reply, and the <a href="../../../glossary#tts">TTS</a> generated audio bytes.</p>
<h2 id="creating-the-audio-reply-stream">Creating the Audio Reply Stream</h2>
<p>Before any audio for the session can be received, the client code should
first create the audio reply stream. Similar to the event stream, this
stream will be closed by the server when the session ends.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// OR create the stream using the Session object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->stream, err := session.<!-- raw HTML omitted -->StreamAudioReplies<!-- raw HTML omitted -->(context.<!-- raw HTML omitted -->Background<!-- raw HTML omitted -->())
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// Create the stream using the client and session ID
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->stream = client.streamAudioReplies(sessionID);</p>
<p><!-- raw HTML omitted -->// OR create the stream using the Session object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->stream = session.streamAudioReplies();
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --># OR create the stream using the Session object<!-- raw HTML omitted -->
stream = session.stream_audio_replies()
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h1 id="or-create-the-stream-using-the-session-object">OR create the stream using the Session object</h1>
<p><!-- raw HTML omitted -->let<!-- raw HTML omitted --> <!-- raw HTML omitted -->stream<!-- raw HTML omitted --> = session.streamAudioReplies { (reply) <!-- raw HTML omitted -->in<!-- raw HTML omitted -->
<!-- raw HTML omitted -->// Handle audio reply<!-- raw HTML omitted -->
}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="receiving-audio">Receiving Audio</h2>
<p>A single reply from Diatheke will have multiple messages on the audio reply
stream. First, it will receive a message containing the text of the reply.
Then, it will receive one or more messages containing the
<a href="../../../glossary#TTS">TTS</a> generated audio data. Lastly, it will receive
an empty message that contains no data, but serves as an indicator that the
reply has finished TTS generation and that no more data will be coming for
the current reply. An example showing how to handle these cases is given
below.</p>
<p>The TTS generated audio data will be formatted and encoded based on the
specific TTS model being used for the session (as defined in the Diatheke
server config file). It is the client code&rsquo;s responsibility to handle
the output audio, whether it sends it to an output device (e.g., speakers),
saves it to a file, or some other processing of the audio data.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// This indicates the stream has finished, which will happen
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// when the session ends or the context used to create the stream
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// closes.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->if<!-- raw HTML omitted --> err == io.EOF {
<!-- raw HTML omitted -->break<!-- raw HTML omitted -->
}
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> err != <!-- raw HTML omitted -->nil<!-- raw HTML omitted --> {
fmt.<!-- raw HTML omitted -->Printf<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;Error: %v\n&quot;<!-- raw HTML omitted -->, err)
<!-- raw HTML omitted -->return<!-- raw HTML omitted -->
}</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Check which message type we have received.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->switch<!-- raw HTML omitted --> reply := msg.OutputMessage.(<!-- raw HTML omitted -->type<!-- raw HTML omitted -->) {
<!-- raw HTML omitted -->case<!-- raw HTML omitted --> *diathekepb.AudioReply_Text:
<!-- raw HTML omitted -->// The text of the reply comes first for a reply from Diatheke.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        fmt.<!-- raw HTML omitted -->Printf<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;Text: %s\n&quot;<!-- raw HTML omitted -->, reply.Text)</p>
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; *diathekepb.AudioReply_Data:
    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Audio data is received until speech synthesis is done.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        fmt.<!-- raw HTML omitted -->Printf<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;Data size (bytes): %v\n&quot;<!-- raw HTML omitted -->, <!-- raw HTML omitted -->len<!-- raw HTML omitted -->(reply.Data))</p>
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; *diathekepb.AudioReply_End:
    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// This message comes at the end of a reply, after speech synthesis
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->// is complete. It has no data.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        fmt.<!-- raw HTML omitted -->Printf<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;Reply complete\n&quot;<!-- raw HTML omitted -->)</p>
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;default&lt;/span&gt;:
    fmt.&lt;span style=&quot;color:#447fcf&quot;&gt;Printf&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;received unexpected AudioReply type\n&amp;#34;&lt;/span&gt;)
}
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>stream-&gt;close();
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;elif&lt;/span&gt; msg.HasField(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;):
    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# Audio data is received until speech synthesis is done.&lt;/span&gt;
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;print&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Data size (bytes): {}&amp;#34;&lt;/span&gt;.format(&lt;span style=&quot;color:#24909d&quot;&gt;len&lt;/span&gt;(reply.data)))

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;elif&lt;/span&gt; msg.HasField(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;end&amp;#34;&lt;/span&gt;):
    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# This message comes at the end of a reply, after speech synthesis&lt;/span&gt;
    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# is complete. It has no data.&lt;/span&gt;
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;print&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Reply complete&amp;#34;&lt;/span&gt;)

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;else&lt;/span&gt;:
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;print&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Received unexpected AudioReply type&amp;#34;&lt;/span&gt;)
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;switch&lt;/span&gt; outputMessage {
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; .text(&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color:#40ffff&quot;&gt;text&lt;/span&gt;):
    print(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Text: &lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt;\(&lt;/span&gt;text&lt;span style=&quot;color:#ed9d13&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; .data(&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color:#40ffff&quot;&gt;audioData&lt;/span&gt;):
    print(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Data size (bytes): &lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt;\(&lt;/span&gt;audioData.count&lt;span style=&quot;color:#ed9d13&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; .end(&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;_&lt;/span&gt;):
    print(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Reply complete&amp;#34;&lt;/span&gt;)
}
</code></pre>
<p>}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/sdk-diatheke/using-diatheke-sdk/session/audio-input/" title="Audio Input"> <i class="fa fa-chevron-left"></i><label>Audio Input</label></a>
    <a class="nav nav-next" href="/sdk-diatheke/using-diatheke-sdk/streaming-asr/" title="Streaming ASR" style="margin-right: 0px;"><label>Streaming ASR</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/sdk-diatheke/js/clipboard.min.js"></script>
<script src="/sdk-diatheke/js/featherlight.min.js"></script>
<script src="/sdk-diatheke/js/html5shiv-printshiv.min.js"></script>

<script src="/sdk-diatheke/js/modernizr.custom.71422.js"></script>
<script src="/sdk-diatheke/js/docdock.js"></script>
<script src="/sdk-diatheke/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>