<!DOCTYPE html>
<html>
  <head>
    <title>Diatheke SDK -- Cobalt</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Event Stream :: Diatheke SDK -- Cobalt</title>
<link rel="shortcut icon" href="/sdk-diatheke/images/favicon.ico" type="image/x-icon" />
<link href="/sdk-diatheke/css/nucleus.css" rel="stylesheet">
<link href="/sdk-diatheke/css/font-awesome.min.css" rel="stylesheet">
<link href="/sdk-diatheke/css/hybrid.css" rel="stylesheet">
<link href="/sdk-diatheke/css/featherlight.min.css" rel="stylesheet">
<link href="/sdk-diatheke/css/auto-complete.css" rel="stylesheet">
<link href="/sdk-diatheke/theme-original/style.css" rel="stylesheet">

  <link href="/sdk-diatheke/theme-original/variant-blue.css" rel="stylesheet">

<link rel="stylesheet" href="/sdk-diatheke/css/bootstrap.min.css">
<script src="/sdk-diatheke/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link href="/sdk-diatheke/css/tabs.css" rel="stylesheet" type="text/css">
<script src="/sdk-diatheke/js/tabs.js"></script>


    
  </head>
  <body data-url="/sdk-diatheke/using-diatheke-sdk/session/event-stream/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p><img src="/sdk-diatheke/images/logo-white.png" alt="Cobalt&rsquo;s SDK Documentation"></p>
<p>Diatheke SDK &ndash; Cobalt</p>

  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/sdk-diatheke/js/lunr.min.js"></script>
		<script type="text/javascript" src="/sdk-diatheke/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/cobaltspeech.github.io\/sdk-diatheke";
        
		</script>
		<script type="text/javascript" src="/sdk-diatheke/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/sdk-diatheke/" class="dd-item">
            <a href="/sdk-diatheke/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/sdk-diatheke/getting-started/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/getting-started/">Getting Started</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/sdk-diatheke/using-diatheke-sdk/">Using Diatheke SDK</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/include/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/include/">
            Including the SDK
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/errors/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/errors/">
            Error Handling
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/connecting/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/connecting/">
            Connecting to the Server
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/sdk-diatheke/using-diatheke-sdk/session/">Sessions</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/create-session/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/create-session/">
            Creating a Session
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/event-stream/" class="dd-item active">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/event-stream/">
            Event Stream
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/push-text/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/push-text/">
            Push Text
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/audio-input/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/audio-input/">
            Audio Input
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/audio-output/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/audio-output/">
            Audio Output
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/streaming-asr/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/streaming-asr/">
            Streaming ASR
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/streaming-tts/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/streaming-tts/">
            Streaming TTS
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/sdk-diatheke/protobuf/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/protobuf/">Diatheke API Reference</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/sdk-diatheke/glossary/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/glossary/">Glossary</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/cobaltspeech/sdk-diatheke" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://www.cobaltspeech.com/contact" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Contact us</label></a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> Clear History</a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        










 <a href='/sdk-diatheke/'>Diatheke SDK Documentation</a> > <a href='/sdk-diatheke/using-diatheke-sdk/'>Using Diatheke SDK</a> > <a href='/sdk-diatheke/using-diatheke-sdk/session/'>Sessions</a> > Event Stream

 

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#creating-the-event-stream">Creating the Event Stream</a></li>
    <li><a href="#event-handling">Event Handling</a>
      <ul>
        <li><a href="#recognize-event">Recognize Event</a></li>
        <li><a href="#reply-event">Reply Event</a></li>
        <li><a href="#command-event">Command Event</a></li>
      </ul>
    </li>
    <li><a href="#event-flow">Event flow</a>
      <ul>
        <li><a href="#audio-based">Audio Based</a></li>
        <li><a href="#text-based">Text Based</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Event Stream</h1>
  



    
    
    
    <p>Diatheke server uses an
<a href="https://en.wikipedia.org/wiki/Event-driven_architecture">event driven architecure</a>
to notify clients when significant events happen for a session. These
include <a href="#recognize-event">Recognize</a>, <a href="#reply-event">Reply</a>, and
<a href="#command-event">Command</a> events. These events are delivered to the
client via a session&rsquo;s event stream.</p>
<h2 id="creating-the-event-stream">Creating the Event Stream</h2>
<p>The following demonstrates how to create a an event stream for a session.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// OR create the stream using the Session object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->stream, err := session.<!-- raw HTML omitted -->EventStream<!-- raw HTML omitted -->(context.<!-- raw HTML omitted -->Background<!-- raw HTML omitted -->())
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// Create the stream using the client and session ID
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->stream = client.sessionEventStream(sessionID);</p>
<p><!-- raw HTML omitted -->// OR create the stream using the session object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->stream = session.eventStream();
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --># OR create the stream using the Session object<!-- raw HTML omitted -->
stream = session.event_stream()
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// OR create the stream using the Session object<!-- raw HTML omitted -->
<!-- raw HTML omitted -->let<!-- raw HTML omitted --> <!-- raw HTML omitted -->stream<!-- raw HTML omitted --> = session.eventStream { (event) <!-- raw HTML omitted -->in<!-- raw HTML omitted -->
<!-- raw HTML omitted -->// Handle the event     <!-- raw HTML omitted -->
}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>This creates a server stream that will deliver events to the client. The
stream will be closed by the server when the session ends.</p>
<h2 id="event-handling">Event Handling</h2>
<p>The recommended way to handle events from the stream is to setup a loop
that waits for the next event, then handles the event based on its type:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// This indicates the stream has finished, which will happen
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// when the session ends or the context used to create the stream
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// closes.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->if<!-- raw HTML omitted --> err == io.EOF {
<!-- raw HTML omitted -->break<!-- raw HTML omitted -->
}</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Handle any other errors
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->if<!-- raw HTML omitted --> err != <!-- raw HTML omitted -->nil<!-- raw HTML omitted --> {
fmt.<!-- raw HTML omitted -->Printf<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;Error: %v\n&quot;<!-- raw HTML omitted -->, err)
<!-- raw HTML omitted -->break<!-- raw HTML omitted -->
}</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Handle the event based on its type.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->switch<!-- raw HTML omitted --> e := event.Result.(<!-- raw HTML omitted -->type<!-- raw HTML omitted -->) {
<!-- raw HTML omitted -->case<!-- raw HTML omitted --> *diathekepb.DiathekeEvent_Recognize:
<!-- raw HTML omitted -->handleRecognizeEvent<!-- raw HTML omitted -->(e.Recognize)</p>
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; *diathekepb.DiathekeEvent_Reply:
    &lt;span style=&quot;color:#447fcf&quot;&gt;handleReplyEvent&lt;/span&gt;(e.Reply)

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; *diathekepb.DiathekeEvent_Command:
    &lt;span style=&quot;color:#447fcf&quot;&gt;handleCommandEvent&lt;/span&gt;(e.Command, manager.Session)

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;default&lt;/span&gt;:
    fmt.&lt;span style=&quot;color:#447fcf&quot;&gt;Printf&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Error: received unknown event type from Diatheke\n&amp;#34;&lt;/span&gt;)
}
</code></pre>
<p>}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// It is good practice to close the event stream when we are done with it.
<!-- raw HTML omitted --><!-- raw HTML omitted -->// This will allow the server to report errors related to the stream, if
<!-- raw HTML omitted --><!-- raw HTML omitted -->// there were any.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->eventStream-&gt;close();
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;elif&lt;/span&gt; event.HasField(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;reply&amp;#34;&lt;/span&gt;):
    handle_reply_event(event.reply)

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;elif&lt;/span&gt; event.HasField(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;command&amp;#34;&lt;/span&gt;):
    handle_command_event(event.command, session)

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;else&lt;/span&gt;:
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;print&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Received unknown event type from Diatheke.&amp;#34;&lt;/span&gt;)
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Check the event type&lt;/span&gt;
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;switch&lt;/span&gt; result {
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; .recognize(&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color:#40ffff&quot;&gt;recognizeEvent&lt;/span&gt;):
        &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;self&lt;/span&gt;.handleRecognizeEvent(recognizeEvent)
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; .reply(&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color:#40ffff&quot;&gt;replyEvent&lt;/span&gt;):
        &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;self&lt;/span&gt;.handleReplyEvent(replyEvent)
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;case&lt;/span&gt; .command(&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color:#40ffff&quot;&gt;commandEvent&lt;/span&gt;):
        &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;self&lt;/span&gt;.handleCommandEvent(commandEvent, session: session)
}
</code></pre>
<p>}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="recognize-event">Recognize Event</h3>
<p>The Recognize event is sent when Diatheke has received user input. In
the case of <a href="../push-text">text-based</a> input, the text of the event
will be the same as what was typed by the user. In the case of
<a href="../audio-input">audio-based</a> input, the event is sent when enough audio
has been processed that a transcription is available. In this case, the
text of the event will be the ASR transcription. The event will also
indicate whether the user input was recognized by the
<a href="../../../glossary#nlu">NLU</a> as a valid
<a href="../../../glossary#intent">intent</a> or <a href="../../../glossary#entity">entity</a>.</p>
<p>Most often, this event will be used by clients to give some kind of
visual indication to the user about whether their input was recognized
or not.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="reply-event">Reply Event</h3>
<p>The Reply event is sent when, based on the session&rsquo;s model, Diatheke has a
reply for the user. This might happen when Diatheke needs additional
information from the user, in which case the text of the Reply event will
be a prompt. This event may also be sent to give the user information,
such as after running a command. The text for all Reply events is
defined in the Diatheke model.</p>
<p>Most often, this event will be used by clients to give some kind of visual
feedback to the user.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="command-event">Command Event</h3>
<p>The Command event is sent when Diatheke wants the client to execute a
command. This happens after the corresponding
<a href="../../../glossary#intent">intent</a> and <a href="../../../glossary#entity">entities</a>
have been recognized, and Diatheke is in a state where the command has
all the required information to execute (as defined by the Diatheke model).</p>
<p>From the client perspective, this is the most important event that will
come from Diatheke because it is what prompts the client code to do useful
work by executing the commands.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// After executing the command, be sure to notify Diatheke that
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// we are done. This is important to do so that dialog flow may continue
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// after the command is finished.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    status := &amp;diathekepb.CommandStatus{
SessionId: session.ID,
CommandId: event.CommandId,</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Indicate success or failure.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        ReturnStatus: diathekepb.CommandStatus_SUCCESS,</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// If the ReturnStatus above is CommandStatus_FAILURE,
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->// the ErrorMessageText field of this struct should also be populated.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->// ErrorMessageText: &quot;some message describing the error&quot;,
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->
<!-- raw HTML omitted -->// Return parameters as necessary. Depending on the Diatheke model,
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->// some commands may be expected to have output.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        OutputParameters: event.Parameters,</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Internal data that should always be set from the original command
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->// event.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        CommandStateId: event.CommandStateId,
}</p>
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err := session.&lt;span style=&quot;color:#447fcf&quot;&gt;CommandFinished&lt;/span&gt;(context.&lt;span style=&quot;color:#447fcf&quot;&gt;Background&lt;/span&gt;(), status); err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    fmt.&lt;span style=&quot;color:#447fcf&quot;&gt;Printf&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Error: %v\n&amp;#34;&lt;/span&gt;, err)
}
</code></pre>
<p>}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>Diatheke::CommandStatus status(event);

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Set the status code to indicate whether the command failed
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    status.setStatusCode(Diatheke::CommandStatus::SUCCESS);</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// If the status code is FAILURE, the error message should also be set
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// status.setError(&quot;some message describing the error&quot;);
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->
<!-- raw HTML omitted -->// Update return parameters as necessary. For example:
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// status.setStringParam(&quot;some key&quot;, &quot;some value&quot;);
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->
<!-- raw HTML omitted -->// Notify Diatheke that the command is finished. This is important
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// to do so that dialog flow may continue after the command is
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->// finished.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    eventStream-&gt;commandFinished(status);
}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# After executing the command, be sure to notify Diatheke that we&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# are done. This is important to do so that dialog flow may continue&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# after the command is finished.&lt;/span&gt;
result = diatheke.CommandStatus()
result.session_id = session.id
result.command_id = event.command_id

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# Indicate success or failure&lt;/span&gt;
result.return_status = diatheke.CommandStatus.SUCCESS

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# If the return_status above is diatheke.CommandStatus.FAILURE,&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# the error_message_text field of this object should also be&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# populated.&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# result.error_message_text = &amp;#34;some message describing the error&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# Return parameters as necessary. Depending on the Diatheke model,&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# some commands may be expected to have output.&lt;/span&gt;
result.output_parameters.update(event.parameters)

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# Internal data that should always be set from the original command&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# event.&lt;/span&gt;
result.command_state_id = event.command_state_id

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;# Send the result to Diatheke&lt;/span&gt;
session.command_finished(result)
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;for&lt;/span&gt; (param, value) &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;in&lt;/span&gt; event.parameters {
    print(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;  &lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt;\(&lt;/span&gt;param&lt;span style=&quot;color:#ed9d13&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt; = &lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt;\(&lt;/span&gt;value&lt;span style=&quot;color:#ed9d13&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;&lt;/span&gt;)
}

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;let&lt;/span&gt; &lt;span style=&quot;color:#40ffff&quot;&gt;status&lt;/span&gt; = CommandStatus(command: event)

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Set the status code to indicate whether the command failed&lt;/span&gt;
status.statusCode = .success

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// If the status code is FAILURE, the error message should also be set&lt;/span&gt;
status.errorMesage = &lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;some message describing the error&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Update return parameters as necessary. For example:&lt;/span&gt;
status.setParam(key: &lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;some key&amp;#34;&lt;/span&gt;, value: &lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;some value&amp;#34;&lt;/span&gt;)

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Notify Diatheke that the command is finished. This is important&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// to do so that dialog flow may continue after the command is&lt;/span&gt;
&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// finished.&lt;/span&gt;
session.commandFinished(commandStatus: status) { (error) &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;in&lt;/span&gt;
    print(error.localizedDescription)
}
</code></pre>
<p>}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h4 id="command-finished">Command Finished</h4>
<p>After receiving a Command event, it is important to notify Diatheke when
command execution has completed. Not only does it let Diatheke know the
final command status (success or failure), but calling <code>CommandFinished</code>
allows Diatheke to continue processing and execute any additional commands
or replies as defined by the Diatheke model.</p>
<p>For long running commands, it should be noted that calling <code>CommandFinished</code>
will restore the dialog to the state Diatheke was at when the Command event
was sent. This allows dialog to remain responsive to other intents while
waiting for long-running commands to finish.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// OR use the Session object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->err := session.<!-- raw HTML omitted -->CommandFinished<!-- raw HTML omitted -->(context.<!-- raw HTML omitted -->Background<!-- raw HTML omitted -->(), status)
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// OR use the Session object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->session.commandFinished(status);</p>
<p><!-- raw HTML omitted -->// OR use the EventStream object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->stream-&gt;commandFinished(status);
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --># OR use the Session object<!-- raw HTML omitted -->
session.command_finished(status)
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// OR use the Session object<!-- raw HTML omitted -->
session.commandFinished(commandStatus: status)
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="event-flow">Event flow</h2>
<h3 id="audio-based">Audio Based</h3>
<p>For an <a href="../audio-input">audio-based</a> dialog, the flow events is shown below.
Based on the Diatheke model, the server will send events in response to
recognized audio and intents.</p>
<link href="/sdk-diatheke/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script defer src="/sdk-diatheke/mermaid/mermaid.js">mermaid.initialize({startOnLoad:true});</script>
<div class="mermaid" align="center" >
sequenceDiagram;
    Note left of Client: Client records<br>audio
    Client ->> Diatheke: Audio input
    Client ->> Diatheke: Audio input
    Client ->> Diatheke: Audio input
    Note right of Diatheke: ASR creates</br>transcript
    Note right of Diatheke: NLU interprets</br>transcript
    Diatheke -->> Client: Recognize event
    Note right of Diatheke: Model finds</br>command for intent
    Diatheke -->> Client: Command event
    Note left of Client: Client executes<br>command
    Client ->> Diatheke: CommandFinished
    Note right of Diatheke: Model finds</br>Say action</br>after command
    Diatheke -->> Client: Reply event
</div>
<h3 id="text-based">Text Based</h3>
<p>For a <a href="../push-text">text-based</a> dialog, the flow events is shown below.
As with the audio-based dialog, the specific type and number of events
will depend on the Diatheke model.
<link href="/sdk-diatheke/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script defer src="/sdk-diatheke/mermaid/mermaid.js">mermaid.initialize({startOnLoad:true});</script>
<div class="mermaid" align="center" >
sequenceDiagram;
    Note left of Client: Client sends<br>text
    Client ->> Diatheke: Text input
    Note right of Diatheke: NLU interprets</br>text
    Diatheke -->> Client: Recognize event
    Note right of Diatheke: Model finds</br>command for intent
    Diatheke -->> Client: Command event
    Note left of Client: Client executes<br>command
    Client ->> Diatheke: CommandFinished
    Note right of Diatheke: Model finds</br>another command
    Diatheke -->> Client: Command event
    Note left of Client: Client executes<br>command
    Client ->> Diatheke: CommandFinished
    Note right of Diatheke: Model finds</br>Say action</br>after command
    Diatheke -->> Client: Reply event
</div></p>


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/sdk-diatheke/using-diatheke-sdk/session/create-session/" title="Creating a Session"> <i class="fa fa-chevron-left"></i><label>Creating a Session</label></a>
    <a class="nav nav-next" href="/sdk-diatheke/using-diatheke-sdk/session/push-text/" title="Push Text" style="margin-right: 0px;"><label>Push Text</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/sdk-diatheke/js/clipboard.min.js"></script>
<script src="/sdk-diatheke/js/featherlight.min.js"></script>
<script src="/sdk-diatheke/js/html5shiv-printshiv.min.js"></script>

<script src="/sdk-diatheke/js/modernizr.custom.71422.js"></script>
<script src="/sdk-diatheke/js/docdock.js"></script>
<script src="/sdk-diatheke/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>