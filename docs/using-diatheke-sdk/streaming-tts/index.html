<!DOCTYPE html>
<html>
  <head>
    <title>Diatheke SDK -- Cobalt</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Streaming TTS :: Diatheke SDK -- Cobalt</title>
<link rel="shortcut icon" href="/sdk-diatheke/images/favicon.ico" type="image/x-icon" />
<link href="/sdk-diatheke/css/nucleus.css" rel="stylesheet">
<link href="/sdk-diatheke/css/font-awesome.min.css" rel="stylesheet">
<link href="/sdk-diatheke/css/hybrid.css" rel="stylesheet">
<link href="/sdk-diatheke/css/featherlight.min.css" rel="stylesheet">
<link href="/sdk-diatheke/css/auto-complete.css" rel="stylesheet">
<link href="/sdk-diatheke/theme-original/style.css" rel="stylesheet">

  <link href="/sdk-diatheke/theme-original/variant-blue.css" rel="stylesheet">

<link rel="stylesheet" href="/sdk-diatheke/css/bootstrap.min.css">
<script src="/sdk-diatheke/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link href="/sdk-diatheke/css/tabs.css" rel="stylesheet" type="text/css">
<script src="/sdk-diatheke/js/tabs.js"></script>


    
  </head>
  <body data-url="/sdk-diatheke/using-diatheke-sdk/streaming-tts/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p><img src="/sdk-diatheke/images/logo-white.png" alt="Cobalt&rsquo;s SDK Documentation"></p>
<p>Diatheke SDK &ndash; Cobalt</p>

  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/sdk-diatheke/js/lunr.min.js"></script>
		<script type="text/javascript" src="/sdk-diatheke/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/cobaltspeech.github.io\/sdk-diatheke";
        
		</script>
		<script type="text/javascript" src="/sdk-diatheke/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/sdk-diatheke/" class="dd-item">
            <a href="/sdk-diatheke/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/sdk-diatheke/getting-started/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/getting-started/">Getting Started</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/sdk-diatheke/using-diatheke-sdk/">Using Diatheke SDK</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/include/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/include/">
            Including the SDK
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/errors/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/errors/">
            Error Handling
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/connecting/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/connecting/">
            Connecting to the Server
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/" class="dd-item haschildren
        ">
      <div>
      <a href="/sdk-diatheke/using-diatheke-sdk/session/">Sessions</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/create-session/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/create-session/">
            Creating a Session
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/event-stream/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/event-stream/">
            Event Stream
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/push-text/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/push-text/">
            Push Text
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/audio-input/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/audio-input/">
            Audio Input
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/session/audio-output/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/session/audio-output/">
            Audio Output
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/streaming-asr/" class="dd-item">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/streaming-asr/">
            Streaming ASR
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-diatheke/using-diatheke-sdk/streaming-tts/" class="dd-item active">
        <div>
          <a href="/sdk-diatheke/using-diatheke-sdk/streaming-tts/">
            Streaming TTS
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/sdk-diatheke/protobuf/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/protobuf/">Diatheke API Reference</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/sdk-diatheke/glossary/" class="dd-item
        ">
      <div>
      <a href="/sdk-diatheke/glossary/">Glossary</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/cobaltspeech/sdk-diatheke" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://www.cobaltspeech.com/contact" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Contact us</label></a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> Clear History</a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='/sdk-diatheke/'>Diatheke SDK Documentation</a> > <a href='/sdk-diatheke/using-diatheke-sdk/'>Using Diatheke SDK</a> > Streaming TTS

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#creating-the-tts-stream">Creating the TTS Stream</a></li>
    <li><a href="#receiving-audio">Receiving Audio</a></li>
  </ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Streaming TTS</h1>
  



    
    
    
    <p>Not to be confused with a session&rsquo;s <a href="../session/audio-output">audio output stream</a>,
a plain <a href="../../glossary#tts">TTS</a> stream is used to synthesize speech
unrelated to any currently running <a href="../session">sessions</a> or Diatheke
models. This means that, unlike audio output from a session which is
sent to the client in response to user input as defined in the model,
the audio output for a plain TTS stream is returned to the client
immediately after the TTS request is made.</p>
<p>This functionality is provided mainly as a convenience. There may be
some situations where it is useful to synthesize audio unrelated to a
running session (such as debugging). For the majority of situations,
Cobalt recommends embedding TTS replies in the Diatheke model itself,
so that they may be returned as part of the normal dialog flow for a
session.</p>
<h2 id="creating-the-tts-stream">Creating the TTS Stream</h2>
<p>The TTS stream requires a Luna model (defined in the Luna server config
file) and the text to synthesize to be specified at creation. The
returned stream will receive audio data from the server until synthesis
is complete and the stream is closed.</p>
<div class='code-tabs'><ul class="nav-tabs"></ul><div class="tab-content">

<div class="tab-pane" title="Go">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#999;font-style:italic">// Specify the Luna model to use (not a Diatheke model)
</span><span style="color:#999;font-style:italic"></span>lunaModel := <span style="color:#ed9d13">&#34;1&#34;</span>
sentence := <span style="color:#ed9d13">&#34;this is the text to synthesize&#34;</span>

<span style="color:#999;font-style:italic">// Create the TTS stream
</span><span style="color:#999;font-style:italic"></span>stream, err := client.<span style="color:#447fcf">StreamTTS</span>(context.<span style="color:#447fcf">Background</span>(), lunaModel, sentence)
</code></pre></div>
</div>


<div class="tab-pane" title="C&#43;&#43;">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">
<span style="color:#999;font-style:italic">// Specify the Luna model to use (not a Diatheke model)
</span><span style="color:#999;font-style:italic"></span>std::string lunaModel = <span style="color:#ed9d13">&#34;1&#34;</span>;
std::string sentence = <span style="color:#ed9d13">&#34;this is the text to synthesize&#34;</span>;

<span style="color:#999;font-style:italic">// Create the TTS stream
</span><span style="color:#999;font-style:italic"></span>std::unique_ptr&lt;Diatheke::TTSStream&gt; stream = 
    client.streamTTS(lunaModel, sentence);
</code></pre></div>
</div>


<div class="tab-pane" title="Python">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#999;font-style:italic"># Specify the Luna model to use (not a Diatheke model)</span>
luna_model = <span style="color:#ed9d13">&#34;1&#34;</span>
sentence = <span style="color:#ed9d13">&#34;this is the text to synthesize&#34;</span>

<span style="color:#999;font-style:italic"># Create the TTS stream</span>
stream = client.stream_tts(luna_model, sentence)
</code></pre></div>
</div>


<div class="tab-pane" title="Swift/iOS">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">
<span style="color:#999;font-style:italic">// Specify the Luna model to use (not a Diatheke model)</span>
<span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">lunaModel</span> = <span style="color:#ed9d13">&#34;1&#34;</span>
<span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">sentence</span> = <span style="color:#ed9d13">&#34;this is the text to synthesize&#34;</span>

<span style="color:#999;font-style:italic">// Create the TTS stream</span>
client.streamTTS(model: lunaModel, text: sentence) { (response) <span style="color:#6ab825;font-weight:bold">in</span>
    <span style="color:#999;font-style:italic">// Handle TTS response</span>
    <span style="color:#6ab825;font-weight:bold">self</span>.handleTTSResponse(response)
}
</code></pre></div>
</div>


<div class="tab-pane" title="Java/Android">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
DiathekeOuterClass.<span style="color:#bbb">TTSRequest</span> ttsRequest = DiathekeOuterClass.<span style="color:#bbb">TTSRequest</span>.<span style="color:#bbb">newBuilder</span>()
        .<span style="color:#bbb">setModel</span>(modelId)
        .<span style="color:#bbb">setText</span>(text)
        .<span style="color:#bbb">build</span>();
mClient.<span style="color:#bbb">streamTTS</span>(ttsRequest, <span style="color:#6ab825;font-weight:bold">new</span> StreamObserver&lt;DiathekeOuterClass.<span style="color:#bbb">TTSResponse</span>&gt;() {
    <span style="color:#ffa500">@Override</span>
    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onNext</span>(DiathekeOuterClass.<span style="color:#bbb">TTSResponse</span> value) {
        handleTTSResponse(value);
    }

    <span style="color:#ffa500">@Override</span>
    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onError</span>(Throwable t) {

    }

    <span style="color:#ffa500">@Override</span>
    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onCompleted</span>() {

    }
});
</code></pre></div>
</div>


</div></div>

<h2 id="receiving-audio">Receiving Audio</h2>
<p>The only data returned on the TTS stream will be audio data. The simplest
way to receive it is to set up a loop to receive and process the data
until the stream is closed, as shown below.</p>
<p>The TTS generated audio data will be formatted and encoded based on the
specific TTS model being used for the stream. It is the client code&rsquo;s
responsibility to handle the output audio, whether it sends it to an output
device (e.g., speakers), saves it to a file, or does some other processing
of the audio data.</p>
<div class='code-tabs'><ul class="nav-tabs"></ul><div class="tab-content">

<div class="tab-pane" title="Go">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#999;font-style:italic">// Receive data from the TTS stream until it is closed, which will happen
</span><span style="color:#999;font-style:italic">// when synthesis is complete, or the context used to create the stream
</span><span style="color:#999;font-style:italic">// is cancelled.
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">for</span> {
    <span style="color:#999;font-style:italic">// Wait for data from the server
</span><span style="color:#999;font-style:italic"></span>    msg, err := stream.<span style="color:#447fcf">Recv</span>()

    <span style="color:#999;font-style:italic">// This indicates the stream has finished, which will happen
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#999;font-style:italic">// when the session ends or the context used to create the stream
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#999;font-style:italic">// closes.
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">if</span> err == io.EOF {
        <span style="color:#6ab825;font-weight:bold">break</span>
    }
    <span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
        fmt.<span style="color:#447fcf">Printf</span>(<span style="color:#ed9d13">&#34;Error: %v\n&#34;</span>, err)
        <span style="color:#6ab825;font-weight:bold">return</span>
    }

    <span style="color:#999;font-style:italic">// Use the audio data, which will be an array of bytes.
</span><span style="color:#999;font-style:italic"></span>    fmt.<span style="color:#447fcf">Printf</span>(<span style="color:#ed9d13">&#34;TTS Data size (bytes): %v\n&#34;</span>, <span style="color:#24909d">len</span>(msg.Data))
}

fmt.<span style="color:#447fcf">Printf</span>(<span style="color:#ed9d13">&#34;Synthesis complete.\n&#34;</span>)
</code></pre></div>
</div>


<div class="tab-pane" title="C&#43;&#43;">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">
<span style="color:#999;font-style:italic">// Receive data from the TTS stream until it is closed, which will happen
</span><span style="color:#999;font-style:italic">// when synthesis is complete.
</span><span style="color:#999;font-style:italic"></span>cobaltspeech::diatheke::TTSResponse response;
<span style="color:#6ab825;font-weight:bold">while</span> (stream-&gt;waitForAudio(&amp;response))
{
    <span style="color:#999;font-style:italic">// Use the audio data, which will be given as a string. Think of it as an
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#999;font-style:italic">// array of chars (a char is one byte).
</span><span style="color:#999;font-style:italic"></span>    std::string audioData = response.data();
    std::cout &lt;&lt; <span style="color:#ed9d13">&#34;TTS Data size (bytes): &#34;</span> &lt;&lt; audioData.size() &lt;&lt; std::endl;
}

std::cout &lt;&lt; <span style="color:#ed9d13">&#34;Synthesis complete.&#34;</span> &lt;&lt; std::endl;
</code></pre></div>
</div>


<div class="tab-pane" title="Python">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#999;font-style:italic"># Receive data from the TTS stream until it is closed, which will happen</span>
<span style="color:#999;font-style:italic"># when synthesis is complete.</span>
<span style="color:#6ab825;font-weight:bold">for</span> response <span style="color:#6ab825;font-weight:bold">in</span> stream:
    <span style="color:#999;font-style:italic"># Use the audio data</span>
    audio_data = response.data
    <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;TTS Data size (bytes): {}&#34;</span>.format(<span style="color:#24909d">len</span>(audio_data)))

<span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;Synthesis complete.&#34;</span>)
</code></pre></div>
</div>


<div class="tab-pane" title="Swift/iOS">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">
<span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">handleTTSResponse</span>(<span style="color:#6ab825;font-weight:bold">_</span> response: Cobaltspeech_Diatheke_TTSResponse) {
    print(<span style="color:#ed9d13">&#34;TTS Data size (bytes): </span><span style="color:#ed9d13">\(</span>response.data.count<span style="color:#ed9d13">)</span><span style="color:#ed9d13">&#34;</span>)
}
</code></pre></div>
</div>


<div class="tab-pane" title="Java/Android">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#6ab825;font-weight:bold">private</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">handleTTSResponse</span>(DiathekeOuterClass.<span style="color:#bbb">TTSResponse</span> value) {
    ByteString data = value.<span style="color:#bbb">getData</span>();
    Log.<span style="color:#bbb">i</span>(<span style="color:#ed9d13">&#34;TTSResponse&#34;</span>,String.<span style="color:#bbb">format</span>(<span style="color:#ed9d13">&#34;TTS Data size (bytes): %d&#34;</span>, data.<span style="color:#bbb">size</span>()))
}
</code></pre></div>
</div>


</div></div>



    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/sdk-diatheke/using-diatheke-sdk/streaming-asr/" title="Streaming ASR"> <i class="fa fa-chevron-left"></i><label>Streaming ASR</label></a>
    <a class="nav nav-next" href="/sdk-diatheke/protobuf/" title="Diatheke API Reference" style="margin-right: 0px;"><label>Diatheke API Reference</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/sdk-diatheke/js/clipboard.min.js"></script>
<script src="/sdk-diatheke/js/featherlight.min.js"></script>
<script src="/sdk-diatheke/js/html5shiv-printshiv.min.js"></script>

<script src="/sdk-diatheke/js/modernizr.custom.71422.js"></script>
<script src="/sdk-diatheke/js/docdock.js"></script>
<script src="/sdk-diatheke/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>